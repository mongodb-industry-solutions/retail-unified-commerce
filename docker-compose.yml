version: "3.9"

services:
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  # ğŸ  Backend â€“ FastAPI + Poetry
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  advanced-search-ms:
    build:
      context: ./backend/advanced-search-ms     # ruta al Dockerfile del back
      dockerfile: Dockerfile
    image: retail-unified-commerce-back:latest # nombre/tag unificado
    container_name: advanced-search-ms
    ports:
      - "8000:8000"                             # host:container
    env_file:
      - ./backend/advanced-search-ms/.env       # se vuelve a montar por si querÃ©s
    restart: unless-stopped
    volumes:                                    # AWS creds (solo lectura)
      - ~/.aws/credentials:/root/.aws/credentials:ro
      - ~/.aws/config:/root/.aws/config:ro
      - ~/.aws/sso/cache:/root/.aws/sso/cache:rw

  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  # âš›ï¸  Frontend â€“ Next.js
  # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #
  nextjs-app:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: retail-unified-commerce-front:latest
    container_name: nextjs-app
    ports:
      - "3000:3000"
    # El frontend fue compilado con .env, pero si querÃ©s
    # sobreescribir variables de *servidor* en runtime, agrÃ©galas aquÃ­:
    # environment:
    #   - SOME_SERVER_ONLY_VAR=foo
    restart: unless-stopped
    depends_on:
      - advanced-search-ms                      # arranca despuÃ©s del backend
